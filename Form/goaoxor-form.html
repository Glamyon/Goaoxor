<script>
  // --- MODAL TOGGLE with lazy-load + postMessage listener ---
  const modal = document.querySelector('#form-modal');
  const modalOpenButtons = document.querySelectorAll('[data-modal="open"]');
  const modalCloseButton = document.querySelector('.modal-close');
  const iframeEl = document.getElementById('goaoxorFormIframe');

  let iframeLoaded = false;

  modalOpenButtons.forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.preventDefault();
      if (!modal) return;
      // lazy load iframe src on first open
      if (!iframeLoaded && iframeEl && iframeEl.dataset && iframeEl.dataset.src) {
        iframeEl.src = iframeEl.dataset.src;
        iframeLoaded = true;
      }
      modal.style.display = 'flex';
      // lock body scroll
      document.body.style.overflow = 'hidden';
    });
  });

  if (modalCloseButton) {
    modalCloseButton.addEventListener('click', () => {
      if (!modal) return;
      modal.style.display = 'none';
      document.body.style.overflow = ''; // restore scroll
    });
  }

  if (modal) {
    modal.addEventListener('click', e => {
      if (e.target === modal) {
        modal.style.display = 'none';
        document.body.style.overflow = '';
      }
    });
  }

  // Listen for postMessage from the iframe (form page). When form posts {goaoxor_form:'submitted'},
  // we auto-close the modal and show a small temporary toast.
  window.addEventListener('message', (e) => {
    try {
      if (!e.data) return;
      if (e.data.goaoxor_form && e.data.goaoxor_form === 'submitted') {
        // close modal
        if (modal) {
          modal.style.display = 'none';
          document.body.style.overflow = '';
        }
        // small success toast
        showInlineToast('Thanks! Your project was submitted â€” we will contact you within 48 hours.');
      }
    } catch (err) {
      console.error('Message handling error:', err);
    }
  });

  // Simple inline toast (non-blocking)
  function showInlineToast(text){
    const t = document.createElement('div');
    t.textContent = text;
    Object.assign(t.style, {
      position: 'fixed',
      right: '20px',
      bottom: '28px',
      background: 'linear-gradient(90deg,#00ddeb,#7a5bff)',
      color:'#04101a',
      padding:'12px 18px',
      borderRadius:'12px',
      boxShadow:'0 8px 30px rgba(0,0,0,0.4)',
      zIndex: 99999,
      fontWeight:700,
      maxWidth:'320px'
    });
    document.body.appendChild(t);
    setTimeout(()=> t.style.opacity='0', 3500);
    setTimeout(()=> t.remove(), 4200);
  }
</script>
